name: pull request
on: pull_request
jobs:
  path-filter:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    outputs:
      workflow: ${{steps.changes.outputs.workflow}}
    steps:
      - uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
        id: changes
        with:
          filters: |
            workflow:
              - .github/workflows/pull_request.yaml
  before-test:
    runs-on: ubuntu-24.04
    permissions: {}
    timeout-minutes: 10
    steps:
      - run: test -n "$FOO"
        env:
          FOO: ${{vars.FOO}}
  test:
    runs-on: ubuntu-24.04
    permissions: {}
    timeout-minutes: 10
    needs:
      - before-test
    steps:
      - run: test -n "$FOO"
        env:
          FOO: ${{vars.FOO}}
  build:
    runs-on: ubuntu-24.04
    permissions: {}
    timeout-minutes: 10
    steps:
      - run: test -n "$FOO"
        env:
          FOO: ${{vars.FOO}}
  check:
    runs-on: ubuntu-24.04
    permissions: {}
    timeout-minutes: 10
    steps:
      - run: test -n "$FOO"
        env:
          FOO: ${{vars.FOO}}
  status-check:
    runs-on: ubuntu-24.04
    timeout-minutes: 10
    needs:
      - path-filter
      - test
      - build
      - check
    if: always()
    permissions:
      contents: read # To get the workflow content by GitHub API
    steps:
      - uses: suzuki-shunsuke/required-status-check-action@latest
        with:
          needs: ${{ toJson(needs) }}
          check_workflow: ${{ needs.path-filter.outputs.workflow }}
  merge:
    runs-on: ubuntu-24.04
    permissions: {}
    timeout-minutes: 10
    needs:
      - status-check
    steps:
      - run: test -n "$FOO"
        env:
          FOO: ${{vars.FOO}}

  notify:
    runs-on: ubuntu-24.04
    permissions: {}
    timeout-minutes: 10
    needs:
      - merge
    steps:
      - run: test -n "$FOO"
        env:
          FOO: ${{vars.FOO}}
